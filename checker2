import camelot
import pandas as pd

def extract_all_tables_to_csv(pdf_path, output_csv="all_extracted_tables.csv"):
    """
    Extracts all tables from the PDF using Camelot, concatenates them, and saves to a CSV.
    Each table is separated by a blank row.
    """
    tables = camelot.read_pdf(pdf_path, pages='all', flavor='stream')
    if tables.n == 0:
        print("No tables found in PDF!")
        return None
    
    all_tables = []
    for i, table in enumerate(tables):
        df = table.df
        # Optionally clean header rows (remove duplicated header row if present)
        if df.iloc[0].equals(df.columns):
            df.columns = df.iloc[0]
            df = df[1:]
        df.columns = [str(col).strip() for col in df.columns]
        df.insert(0, "Table#", i+1)  # Add table number for clarity
        all_tables.append(df)
        # Add a blank row (same number of columns) for separation, except after the last table
        if i < tables.n - 1:
            blank_row = pd.DataFrame([[""] * len(df.columns)], columns=df.columns)
            all_tables.append(blank_row)
    
    # Concatenate all tables into one big DataFrame
    combined = pd.concat(all_tables, ignore_index=True)
    combined.to_csv(output_csv, index=False)
    print(f"Extracted {tables.n} tables. Combined table saved to '{output_csv}'")
    print("First 10 rows preview:")
    print(combined.head(10))
    return combined

# Usage:
# extract_all_tables_to_csv("yourfile.pdf")
